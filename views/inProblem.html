{% extends "inTemplate.html" %}

{% block style %}
    <link href="./bootstrap/css/inProblem.css" rel="stylesheet" >
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
      });
    </script>
{% endblock %}


{% block sidebar %}
    <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav side-nav">
            <li>
                <a href="/"><i class="fa fa-fw fa-home"></i> Home</a>
            </li>
            <li class="active">
                <a href="/inProblem"><i class="fa fa-fw fa-edit"></i> New Problem</a>
            </li>
            <li>
                <a href="/inMyProblems"><i class="fa fa-fw fa-edit"></i> My Problems</a>
            </li>
        </ul>
    </div>
            <!-- /.navbar-collapse -->
{% endblock %}

{% block maincontent %}
        <div id="page-wrapper">

            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">
                            Add a Problem
                            <small></small>
                        </h1>
                    </div>
                </div>

<!-- -->



<h2 id="display"></h2>

<ul class="mbttn">

  <li onclick="addLaTex('\\frac{x}{y} ')">
    <script type="math/tex">\frac{x}{y}</script>
  </li>

  <li onclick="addLaTex('x\\cdot y')">
    <script type="math/tex">x\cdot y</script>
  </li>

  <li onclick="addLaTex('x^{xy}')">
    <script type="math/tex">x^{xy}</script>
  </li>

  <li onclick="addLaTex('\\sqrt{x} ')">
    <script type="math/tex">\sqrt{x}</script>
  </li>

  <li onclick="addLaTex('\\sqrt[3]{x}')">
    <script type="math/tex">\sqrt[3]{x}</script>
  </li>

  <li onclick="addLaTex('|x| ')">
    <script type="math/tex">|x|</script>
  </li>

  <li onclick="addLaTex('\\alpha ')">
    <script type="math/tex">\alpha</script>
  </li>

  <li onclick="addLaTex('\\beta ')">
    <script type="math/tex">\beta</script>
  </li>

  <li onclick="addLaTex('\\Delta ')">
    <script type="math/tex">\Delta</script>
  </li>

  <li onclick="addLaTex('\\Omega ')">
    <script type="math/tex">\Omega</script>
  </li>

  <li onclick="addLaTex('\\ge ')">
    <script type="math/tex">\ge</script>
  </li>

  <li onclick="addLaTex('\\ne ')">
    <script type="math/tex">\ne</script>
  </li>

  <li onclick="addLaTex('\\infty ')">
    <script type="math/tex">\infty</script>
  </li>

  <li onclick="addLaTex('\\sum_{i=0}^n ')">
    <script type="math/tex">\sum_{i=0}^n</script>
  </li>

</ul>
<div class="inputArea">
  <form action="/inProblem" method="POST">
    <label for="data">Question:</label>
    <input type="text" id="textbox" name="problem">
    <!--    <button onclick="nextFun()" id ="prev" type="submit">previous</button> -->
    <button id ="next" type="submit">save</button>
  </form>
</div>
                </div>
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /#page-wrapper -->
    </div>

<script>
/*******************************************************************************
* Variables set to match ids of elements:
*
**********/
var textbox = document.getElementById("textbox");
var display = document.getElementById("display");
var old;
var displayRefreshRate;


/*******************************************************************************
* Page Load
* ---------
*  - Focus the textbox
*  - Then, scroll back to the top
*  - Mathjax buttons show up later to avoid jittery behaivior
*
**********/
window.onload = function(){

  textbox.focus();
  window.scrollTo(0,0);

  setTimeout(function(){
    $("ul.mbttn li").css("color", "#f2f2f2");
  }, 400);
  displayRefreshRate = setInterval(match, 800);

}

/*******************************************************************************
* Display Function
* ----------------
* - Make the math display match the textbox
* - A timeout where the text is invisible allows the mathjax to render
*
**********/

function match() {
  if( old != textbox.value ){
    clearInterval(displayRefreshRate);
    display.style.color = "white";
    display.innerHTML = '' + textbox.value + '';
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,display]);
    old = this.textbox.value;
    setTimeout(
      function visible(){ display.style.color = "black";}, 300
    );
    displayRefreshRate = setInterval(match, 100);
  }
}


/*******************************************************************************
* LaTeX Button Function
* ---------------------
* - Put the Latex in the textbox
* - Re-focus the textbox
*
**********/
function addLaTex(latex){
  textbox.value=textbox.value.concat(latex);
  textbox.focus();
}


/*******************************************************************************
* Offline Functions:
* -----------------
* Only used to test js while server is not running
* 1.)  Clear the textbox
*      - called by <enter>, next, or prev buttons
*
* 2.)  <Enter> key event listener
*
**********/
function nextFun() {
  textbox.value = "";
}
textbox.addEventListener("keyup",
  function(event) {
    event.preventDefault();
    if (event.keyCode == 13) {
        document.getElementById("next").click();
    }
});


</script>

{% endblock %}
